<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • psychinterpreter</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">psychinterpreter</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/01-Basic_Usage.html">Basic usage of the 'psychinterpreter' Package</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>CLAUDE.md</h1>

    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="package-overview">Package Overview<a class="anchor" aria-label="anchor" href="#package-overview"></a></h2>
<p><strong>psychinterpreter</strong> is an R package that automates the interpretation of exploratory factor analysis (EFA) and cluster analysis results using Large Language Models (LLMs) via the <code>ellmer</code> package. It interfaces with various LLM providers (OpenAI, Anthropic, Ollama, Gemini, Azure) to generate human-readable factor names and interpretations based on loading patterns and variable descriptions.</p>
</div>
<div class="section level2">
<h2 id="core-architecture">Core Architecture<a class="anchor" aria-label="anchor" href="#core-architecture"></a></h2>
<div class="section level3">
<h3 id="llm-powered-interpretation-pipeline">LLM-Powered Interpretation Pipeline<a class="anchor" aria-label="anchor" href="#llm-powered-interpretation-pipeline"></a></h3>
<p>The package uses a sophisticated multi-stage pipeline:</p>
<ol style="list-style-type: decimal"><li>
<strong>Factor Analysis Preparation</strong> (R/fa_utilities.R):
<ul><li>Analyzes factor loadings against configurable cutoffs</li>
<li>Identifies significant loadings per factor</li>
<li>Applies “emergency rule” for weak factors (uses top N variables if none exceed cutoff)</li>
<li>Detects cross-loadings and orphaned variables</li>
</ul></li>
<li>
<strong>Prompt Engineering &amp; LLM Communication</strong> (R/interpret_fa.R):
<ul><li>Constructs structured prompts with psychometric context</li>
<li>Uses compact vector format for efficient token usage</li>
<li>Processes ALL factors in a single LLM call (batch processing optimization)</li>
<li>Includes factor correlations for oblique rotations</li>
<li>Supports persistent chat sessions via <code>chat_fa</code> objects to avoid resending system prompts</li>
</ul></li>
<li>
<strong>Report Generation</strong> (R/fa_report_functions.R):
<ul><li>Builds comprehensive reports in text or markdown format</li>
<li>Includes factor interpretations, cross-loadings, and diagnostic information</li>
<li>Configurable heading levels for document integration</li>
<li>Text wrapping for console output</li>
</ul></li>
</ol></div>
<div class="section level3">
<h3 id="persistent-chat-sessions">Persistent Chat Sessions<a class="anchor" aria-label="anchor" href="#persistent-chat-sessions"></a></h3>
<p>Key innovation for cost/efficiency optimization:</p>
<ul><li>
<strong><code>chat_fa</code> objects</strong> (R/chat_fa.R): Reusable LLM sessions that preserve system prompt</li>
<li>Single analysis: Creates temporary session</li>
<li>Multiple analyses: Create one <code>chat_fa</code>, pass to multiple <code><a href="reference/interpret_fa.html">interpret_fa()</a></code> calls</li>
<li>Saves ~500+ tokens per additional analysis by not resending system prompt</li>
</ul></div>
<div class="section level3">
<h3 id="key-design-patterns">Key Design Patterns<a class="anchor" aria-label="anchor" href="#key-design-patterns"></a></h3>
<p><strong>Single Responsibility</strong>: Each R file handles one aspect: - <code>interpret_fa.R</code>: Main interpretation logic and LLM coordination - <code>chat_fa.R</code>: Chat session management - <code>fa_utilities.R</code>: Data analysis utilities (cross-loadings, no-loadings detection) - <code>utils.R</code>: Text processing helpers (word counting, text wrapping) - <code>fa_report_functions.R</code>: Report building and formatting - <code>export_functions.R</code>: Multi-format export (CSV, JSON, RDS, TXT) - <code>visualization.R</code>: S3 plot method and ggplot2-based heatmap visualizations</p>
<p><strong>S3 Methods</strong>: Package implements custom methods for standard R generics: - <code><a href="reference/print.fa_interpretation.html">print.fa_interpretation()</a></code>: Formatted console output with text wrapping - <code><a href="reference/print.chat_fa.html">print.chat_fa()</a></code>: Session info and token usage display - <code><a href="reference/plot.fa_interpretation.html">plot.fa_interpretation()</a></code>: Factor loading heatmap visualization - Backward-compatible wrappers: <code><a href="reference/create_factor_plot.html">create_factor_plot()</a></code> calls <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method</p>
<p><strong>Provider Abstraction</strong>: Uses <code>ellmer</code> package’s unified interface for LLM providers. Switch providers by changing parameters, not code.</p>
<p><strong>Structured Output</strong>: LLM returns JSON with factor names as keys, parsed with fallback extraction methods for robustness.</p>
</div>
</div>
<div class="section level2">
<h2 id="common-development-commands">Common Development Commands<a class="anchor" aria-label="anchor" href="#common-development-commands"></a></h2>
<div class="section level3">
<h3 id="building--checking">Building &amp; Checking<a class="anchor" aria-label="anchor" href="#building--checking"></a></h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate documentation from roxygen2 comments</span></span>
<span><span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenise</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run R CMD check</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install package locally</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load for development</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run all tests</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">test</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run specific test file</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_file.html" class="external-link">test_file</a></span><span class="op">(</span><span class="st">"tests/testthat/test-interpret_fa.R"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build package documentation</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">document</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview help for function</span></span>
<span><span class="op">?</span><span class="va">interpret_fa</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="llm-provider-configuration">LLM Provider Configuration<a class="anchor" aria-label="anchor" href="#llm-provider-configuration"></a></h2>
<p>API keys must be set as environment variables before using the package:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># OpenAI</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>OPENAI_API_KEY <span class="op">=</span> <span class="st">"your-key"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Anthropic</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>ANTHROPIC_API_KEY <span class="op">=</span> <span class="st">"your-key"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For Ollama (local), no key needed</span></span></code></pre></div>
<p>Provider-specific chat initialization handled by <code>ellmer</code> package through switch statement in interpret_fa.R:587-766.</p>
</div>
<div class="section level2">
<h2 id="important-implementation-details">Important Implementation Details<a class="anchor" aria-label="anchor" href="#important-implementation-details"></a></h2>
<div class="section level3">
<h3 id="json-parsing-strategy-interpret_far1015-1161">JSON Parsing Strategy (interpret_fa.R:1015-1161)<a class="anchor" aria-label="anchor" href="#json-parsing-strategy-interpret_far1015-1161"></a></h3>
<p>Multi-tiered fallback approach for robust LLM response handling: 1. Try parsing cleaned JSON (remove extra text, fix formatting issues) 2. Fall back to original response 3. Pattern-based extraction if JSON parsing fails 4. Default values if all methods fail</p>
<p>Critical for handling small/local models that may produce imperfect JSON.</p>
</div>
<div class="section level3">
<h3 id="word-limit-enforcement">Word Limit Enforcement<a class="anchor" aria-label="anchor" href="#word-limit-enforcement"></a></h3>
<p>The package targets 80-100% of <code>word_limit</code> parameter for interpretations: - System prompt includes explicit word targets - Post-processing validates and warns if exceeded - Helper function <code><a href="reference/count_words.html">count_words()</a></code> in utils.R</p>
</div>
<div class="section level3">
<h3 id="factor-correlation-integration">Factor Correlation Integration<a class="anchor" aria-label="anchor" href="#factor-correlation-integration"></a></h3>
<p>When <code>factor_cor_mat</code> provided (for oblique rotations): - Included in LLM prompt for relationship context - Helps LLM understand discriminant vs. convergent validity - Displayed in report sections (both summary and per-factor)</p>
</div>
<div class="section level3">
<h3 id="emergency-rule-logic-interpret_far600-617">Emergency Rule Logic (interpret_fa.R:600-617)<a class="anchor" aria-label="anchor" href="#emergency-rule-logic-interpret_far600-617"></a></h3>
<p>If a factor has zero loadings above cutoff: - Uses top <code>n_emergency</code> highest absolute loadings instead - Clearly marked in output with WARNING - Prevents empty factor interpretations</p>
</div>
</div>
<div class="section level2">
<h2 id="code-style-conventions">Code Style Conventions<a class="anchor" aria-label="anchor" href="#code-style-conventions"></a></h2>
<ul><li>
<strong>Roxygen2 documentation</strong>: Required for all exported functions</li>
<li>
<strong>Examples limit</strong>: Maximum 2 examples per function in documentation</li>
<li>
<strong>Explicit namespacing</strong>: Use <code>package::function()</code> notation (e.g., <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code>)</li>
<li>
<strong>CLI messaging</strong>: Use <code>cli</code> package for user-facing messages (cli_alert_info, cli_abort, cli_warn)</li>
<li>
<strong>Pipe operator</strong>: Uses base R <code>|&gt;</code> pipe (not magrittr <code>%&gt;%</code>)</li>
<li>
<strong>Parameter validation</strong>: Extensive validation with informative error messages at function start</li>
</ul></div>
<div class="section level2">
<h2 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a></h2>
<div class="section level3">
<h3 id="imports-required">Imports (Required)<a class="anchor" aria-label="anchor" href="#imports-required"></a></h3>
<ul><li>
<code>ellmer</code>: LLM communication layer</li>
<li>
<code>dplyr</code>, <code>tidyr</code>: Data manipulation</li>
<li>
<code>cli</code>: User messaging</li>
<li>
<code>jsonlite</code>: JSON parsing</li>
</ul></div>
<div class="section level3">
<h3 id="suggests-optional">Suggests (Optional)<a class="anchor" aria-label="anchor" href="#suggests-optional"></a></h3>
<ul><li>
<code>ggplot2</code>: Visualization (plot() method and create_factor_plot())</li>
<li>
<code>testthat</code>: Testing framework</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="exported-functions">Exported Functions<a class="anchor" aria-label="anchor" href="#exported-functions"></a></h2>
<p>The package exports 12 functions plus 3 S3 methods:</p>
<p><strong>Main Functions:</strong> - <code><a href="reference/interpret_fa.html">interpret_fa()</a></code> - Core factor interpretation with LLM - <code><a href="reference/chat_fa.html">chat_fa()</a></code> - Create persistent chat session - <code><a href="reference/is.chat_fa.html">is.chat_fa()</a></code> - Check if object is chat_fa - <code><a href="reference/reset.chat_fa.html">reset.chat_fa()</a></code> - Reset chat session</p>
<p><strong>Utilities:</strong> - <code><a href="reference/find_cross_loadings.html">find_cross_loadings()</a></code> - Detect cross-loading variables - <code><a href="reference/find_no_loadings.html">find_no_loadings()</a></code> - Detect variables with no significant loadings - <code><a href="reference/export_interpretation.html">export_interpretation()</a></code> - Export results to multiple formats - <code><a href="reference/create_factor_plot.html">create_factor_plot()</a></code> - Standalone plotting function (wrapper)</p>
<p><strong>S3 Methods:</strong> - <code><a href="reference/print.fa_interpretation.html">print.fa_interpretation()</a></code> - Print interpretation results - <code><a href="reference/print.chat_fa.html">print.chat_fa()</a></code> - Print chat session info - <code><a href="reference/plot.fa_interpretation.html">plot.fa_interpretation()</a></code> - Visualize factor loadings</p>
</div>
<div class="section level2">
<h2 id="testing-strategy">Testing Strategy<a class="anchor" aria-label="anchor" href="#testing-strategy"></a></h2>
<p>Currently no tests implemented (tests/ directory doesn’t exist). When adding tests: - Use <code>testthat</code> framework (already in DESCRIPTION Suggests) - Skip tests requiring API keys unless credentials available - Create fixtures for factor loading matrices and variable descriptions - Test both single-analysis and persistent chat session workflows</p>
</div>
<div class="section level2">
<h2 id="file-organization">File Organization<a class="anchor" aria-label="anchor" href="#file-organization"></a></h2>
<pre><code>R/
├── interpret_fa.R          # Main interpretation function (~1270 lines)
├── chat_fa.R               # Persistent chat session management
├── fa_utilities.R          # Cross-loading &amp; no-loading detection
├── utils.R                 # Word counting, text wrapping
├── fa_report_functions.R   # Report building, print methods
├── export_functions.R      # Export to CSV/JSON/RDS/TXT
└── visualization.R         # ggplot2 heatmap creation

dev/
└── PACKAGE_MIGRATION_PLAN.md  # Historical migration documentation

vignettes/
└── articles/
    └── 01-Basic_Usage.qmd   # Example usage with BFI dataset</code></pre>
</div>
<div class="section level2">
<h2 id="common-workflows">Common Workflows<a class="anchor" aria-label="anchor" href="#common-workflows"></a></h2>
<div class="section level3">
<h3 id="visualizing-factor-analysis-results">Visualizing Factor Analysis Results<a class="anchor" aria-label="anchor" href="#visualizing-factor-analysis-results"></a></h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get interpretation results</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/interpret_fa.html">interpret_fa</a></span><span class="op">(</span><span class="va">loadings</span>, <span class="va">variable_info</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use S3 plot method (recommended)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or use backward-compatible function</span></span>
<span><span class="fu"><a href="reference/create_factor_plot.html">create_factor_plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save plot</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"loadings.png"</span>, <span class="va">p</span>, width <span class="op">=</span> <span class="fl">10</span>, height <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Customize plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Custom Title"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-new-llm-provider-support">Adding New LLM Provider Support<a class="anchor" aria-label="anchor" href="#adding-new-llm-provider-support"></a></h3>
<ol style="list-style-type: decimal"><li>
<code>ellmer</code> package handles provider abstraction - no changes needed to psychinterpreter</li>
<li>Users simply specify provider name and model in function calls</li>
</ol></div>
<div class="section level3">
<h3 id="modifying-system-prompt">Modifying System Prompt<a class="anchor" aria-label="anchor" href="#modifying-system-prompt"></a></h3>
<p>The psychometric expert system prompt is defined in TWO locations: - <code>interpret_fa.R:294-330</code> (single-use sessions) - <code>chat_fa.R:57-73</code> (persistent sessions)</p>
<p><strong>CRITICAL</strong>: Keep both prompts synchronized when making changes.</p>
</div>
<div class="section level3">
<h3 id="adding-new-output-formats">Adding New Output Formats<a class="anchor" aria-label="anchor" href="#adding-new-output-formats"></a></h3>
<ol style="list-style-type: decimal"><li>Add format to <code><a href="reference/export_interpretation.html">export_interpretation()</a></code> switch statement (export_functions.R:93)</li>
<li>Implement format-specific export logic</li>
<li>Update function documentation with new format description</li>
</ol></div>
<div class="section level3">
<h3 id="extending-report-formats">Extending Report Formats<a class="anchor" aria-label="anchor" href="#extending-report-formats"></a></h3>
<p>Report generation in <code>build_fa_report()</code> (fa_report_functions.R:18) supports: - <code>output_format</code>: “text” or “markdown” - <code>heading_level</code>: For markdown hierarchy integration - <code>suppress_heading</code>: For embedding in existing documents</p>
<p>Add new formats by extending the conditional logic at line 39 (markdown) and 244 (text).</p>
</div>
</div>
<div class="section level2">
<h2 id="debugging-tips">Debugging Tips<a class="anchor" aria-label="anchor" href="#debugging-tips"></a></h2>
<div class="section level3">
<h3 id="enable-llm-promptresponse-visibility">Enable LLM Prompt/Response Visibility<a class="anchor" aria-label="anchor" href="#enable-llm-promptresponse-visibility"></a></h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/interpret_fa.html">interpret_fa</a></span><span class="op">(</span><span class="va">...</span>, echo <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>  <span class="co"># Shows prompts and responses</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-token-usage">Check Token Usage<a class="anchor" aria-label="anchor" href="#check-token-usage"></a></h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/chat_fa.html">chat_fa</a></span><span class="op">(</span><span class="st">"anthropic"</span>, <span class="st">"claude-haiku-4-5-20251001"</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/interpret_fa.html">interpret_fa</a></span><span class="op">(</span><span class="va">...</span>, chat_session <span class="op">=</span> <span class="va">chat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">chat</span><span class="op">)</span>  <span class="co"># Displays token counts</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="validate-json-response-parsing">Validate JSON Response Parsing<a class="anchor" aria-label="anchor" href="#validate-json-response-parsing"></a></h3>
<p>Look for warnings from interpret_fa.R:1044 about batch JSON parsing failures. Consider using larger models if small models produce invalid JSON.</p>
</div>
</div>
<div class="section level2">
<h2 id="version-history">Version History<a class="anchor" aria-label="anchor" href="#version-history"></a></h2>
<ul><li>
<strong>0.0.0.9000</strong>: Development version</li>
<li>R version requirement: &gt;= 4.1.0</li>
</ul></div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a></h2>
<p>MIT + file LICENSE</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthias Kloft.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

